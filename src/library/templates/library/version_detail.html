{% extends "base.html" %}

{% block title %}v{{ version.version }} - {{ COMPANY_NAME }}{% endblock %}

{% block content %}
<nav class="text-sm text-gray-500 mb-4" aria-label="breadcrumb">
    <a href="{% url 'library:version-list' %}" class="hover:text-gray-700">Versions</a>
    <span class="mx-1">/</span>
    <span class="text-gray-800">v{{ version.version }}</span>
</nav>

<h2 class="text-2xl font-bold mb-6">
    v{{ version.version }}
    {% if version.is_current %}<span class="inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800 ml-2 align-middle">Current</span>{% endif %}
</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b"><h5 class="font-semibold">Details</h5></div>
            <div class="p-6">
                <dl class="grid grid-cols-3 gap-y-3 text-sm">
                    <dt class="font-medium text-gray-600">Schema Version</dt>
                    <dd class="col-span-2">{{ version.schema_version }}</dd>
                    <dt class="font-medium text-gray-600">Released</dt>
                    <dd class="col-span-2">{{ version.released_at|date:"Y-m-d H:i" }}</dd>
                    <dt class="font-medium text-gray-600">Published By</dt>
                    <dd class="col-span-2">{{ version.published_by|default:"â€”" }}</dd>
                    {% if version.notes %}
                    <dt class="font-medium text-gray-600">Notes</dt>
                    <dd class="col-span-2">{{ version.notes }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>

    <div>
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b"><h5 class="font-semibold">Changes</h5></div>
            <div class="p-6">
                {% if changes %}
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left py-2 px-2 font-semibold">Device</th>
                            <th class="text-left py-2 px-2 font-semibold">Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for change in changes %}
                        <tr class="border-b">
                            <td class="py-2 px-2">{{ change.device_type.name }}</td>
                            <td class="py-2 px-2">
                                {% if change.change_type == "added" %}
                                    <span class="inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800">Added</span>
                                {% elif change.change_type == "modified" %}
                                    <span class="inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Modified</span>
                                {% elif change.change_type == "removed" %}
                                    <span class="inline-flex px-2 py-0.5 text-xs font-semibold rounded-full bg-red-100 text-red-800">Removed</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-gray-500">No device changes tracked for this version.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
